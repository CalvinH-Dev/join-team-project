<div class="form-scroll" role="region" aria-label="Add task form">

    <div class="form-row">
        <label class="label">Title <span class="required">*</span></label>
        <input class="input text-input" type="text" placeholder="Enter a title" [(ngModel)]="title" name="title"
            required #titleInput="ngModel" (focus)="titleFocus = true" (blur)="titleFocus = false"
            [ngClass]="{'focus': titleFocus, 'error': titleInput.invalid && titleInput.touched}" />

        <div class="field-error" *ngIf="titleInput.invalid && titleInput.touched">
            This field is required
        </div>
    </div>



    <div class="form-row description-row">
        <label class="label">Description</label>
        <div class="textarea-wrap">
            <textarea class="input textarea-input" placeholder="Enter a Description" [(ngModel)]="description"
                name="description" (focus)="descriptionFocus = true" (blur)="descriptionFocus = false"
                [ngClass]="{'focus': descriptionFocus}"></textarea>
            <img class="recurso-icon" src="images/add_task_section/recurso.svg" alt="Recurso Icon">
        </div>
    </div>



    <div class="form-row">
        <label class="label">Due date <span class="required">*</span></label>
        <div class="input-with-icon">
            <input class="input date-input" type="text" placeholder="dd/mm/yyyy" [(ngModel)]="dueDate" name="dueDate"
                #dueDateInput="ngModel" (focus)="dueDateFocus = true" (blur)="dueDateFocus = false"
                [ngClass]="{'focus': dueDateFocus, 'error': dueDateInput.invalid && dueDateInput.touched}" required />
            <button class="icon-btn date-icon" type="button" aria-hidden="true">
                <img src="images/add_task_section/events_icon.svg" alt="">
            </button>
        </div>

        <div class="field-error" *ngIf="dueDateInput.invalid && dueDateInput.touched">
            This field is required
        </div>
    </div>

    <div class="form-row">
        <label class="label">Priority</label>

        <div class="priority-row" role="tablist" aria-label="Priority">
            <button class="prio-btn prio-urgent" [class.active]="selectedPriority === 'urgent'"
                (click)="setPriority('urgent')">
                <span class="prio-text">Urgent</span>
                <span class="prio-ico" aria-hidden>
                    <img
                        [src]="selectedPriority === 'urgent' ? 'images/add_task_section/prio_alta_white.svg' : 'images/add_task_section/prio_alta_red.svg'">
                </span>
            </button>

            <button class="prio-btn prio-medium" [class.active]="selectedPriority === 'medium'"
                (click)="setPriority('medium')">
                <span class="prio-text">Medium</span>
                <span class="prio-ico" aria-hidden>
                    <img
                        [src]="selectedPriority === 'medium' ? 'images/add_task_section/priority_symbols_white.svg' : 'images/add_task_section/priority_symbols.svg'">
                </span>
            </button>

            <button class="prio-btn prio-low" [class.active]="selectedPriority === 'low'" (click)="setPriority('low')">
                <span class="prio-text">Low</span>
                <span class="prio-ico" aria-hidden>
                    <img
                        [src]="selectedPriority === 'low' ? 'images/add_task_section/prio_baja_white.svg' : 'images/add_task_section/prio_baja.svg'">
                </span>
            </button>
        </div>
    </div>

    <!-- <div class="form-row">
        <label class="label">Assigned to</label>
        <div class="select-wrap" [class.focus]="assignedFocus">
            <div class="select-input" (click)="onInputClick()" (focus)="assignedFocus = true"
                (blur)="assignedFocus = false" tabindex="0">
                {{ assignedTo || 'Select contacts to assign' }}
                <span class="select-arrow" aria-hidden>
                    <img src="images/add_task_section/arrow_drop_downaa.svg">
                </span>
            </div>
            <ul class="dropdown-list" *ngIf="assignedDropdownOpen">
                <li *ngFor="let person of ['Madina', 'Calvin', 'Falko', 'Christoph', 'Philip']"
                    (click)="selectAssigned(person)" [class.active]="activeItem === person">
                    {{ person }}
                </li>
            </ul>
        </div>
    </div> -->


    <div class="form-row">
        <label class="label">Assigned to</label>

        <!-- select-wrap: contains input and dropdown (dropdown is absolute) -->
        <div class="select-wrap" [class.focus]="assignedFocus">
            <div class="select-input" (click)="onInputClick()" (focus)="assignedFocus = true"
                (blur)="assignedFocus = false" tabindex="0">
                Select contacts to assign
                <span class="select-arrow" aria-hidden>
                    <img src="images/add_task_section/arrow_drop_downaa.svg" alt="">
                </span>
            </div>

            <!-- dropdown: absolutely positioned, floats on top -->
            <ul class="dropdown-list" *ngIf="assignedDropdownOpen">
                <li *ngFor="let person of ['Madina','Calvin','Falko','Christoph','Philip']"
                    (click)="$event.stopPropagation(); toggleAssigned(person)" [class.selected]="isAssigned(person)">
                    <span class="person-name">{{ person }}</span>
                    <input class="person-checkbox" type="checkbox" [checked]="isAssigned(person)" />
                </li>
            </ul>
        </div>

        <!-- selected-list is a sibling below select-wrap and in normal flow -->
        <div class="selected-list" *ngIf="assignedTo.length">
            <span class="selected-item" *ngFor="let person of assignedTo">
                {{ person }}
            </span>
        </div>
    </div>

    <div class="form-row">
        <label class="label">Category <span class="required">*</span></label>
        <div class="select-wrap" [class.focus]="categoryFocus">
            <!-- Field -->
            <div class="select-input" (click)="onCategoryClick()" (focus)="categoryFocus = true"
                (blur)="categoryFocus = false; categoryTouched = true" tabindex="0">
                {{ category || 'Select task category' }}
                <span class="select-arrow" aria-hidden>
                    <img src="images/add_task_section/arrow_drop_downaa.svg">
                </span>
            </div>

            <ul class="dropdown-list" *ngIf="categoryDropdownOpen">
                <li *ngFor="let cat of ['User Story', 'Technical Task']" (click)="selectCategory(cat)"
                    [class.active]="activeCategory === cat">
                    {{ cat }}
                </li>
            </ul>
        </div>

        <div class="field-error" *ngIf="!category && categoryTouched">
            This field is required
        </div>
    </div>


    <div class="form-row">
        <label class="label">Subtasks</label>
        <input class="input text-input" type="text" placeholder="Add new subtask" [(ngModel)]="subtask" name="subtask"
            (focus)="subtaskFocus = true" (blur)="subtaskFocus = false" [ngClass]="{'focus': subtaskFocus}" />
    </div>

    <div class="bottom-spacer" aria-hidden="true"></div>
</div>


<div class="form-actions" role="toolbar" aria-label="Form actions">
    <button class="btn-clear" type="button">Clear <img src="images/assets/cancel_icon.svg"></button>
    <button class="btn-create" type="button">Create Task <img src="images/assets/check.svg"></button>
</div>