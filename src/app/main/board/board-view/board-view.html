<div class="board-container">
	<header class="board-header">
		<h1 class="board-title">Board</h1>
		<div class="header-controls">
			<app-search-field (searchText)="onSearch($event)"></app-search-field>

      <button class="desktop-btn" type="button"
      (click)="openAddTaskOverlay()">Add task
        <img src="images/board_section/add_icon.svg">
      </button>

 <!--      <app-button
        class="desktop-add-button"
        variant="primary"
        (click)="openAddTaskOverlay()"
        [fullWidth]="true"
        title="Add task"
        icon="images/board_section/add_icon.svg"
      >
        Add task
      </app-button> -->
    </div>
  </header>

	<main class="board-columns">
		<!-- TO DO COLUMN -->
		<div
			class="column-status"
			cdkDropList
			id="todo"
			[cdkDropListConnectedTo]="dropListIds"
			[cdkDropListData]="todoTasks()"
			(cdkDropListDropped)="drop($event)"
		>
			<div class="desktop-headline-btn">
				<h2 class="column-title">To Do</h2>
				<div class="btn-overlay"></div>
			</div>
			<div class="column-body">
				@for (task of todoTasks(); track task.id) {
					<app-board-card
						cdkDrag
						[cdkDragData]="task"
						[task]="task"
						(cardClicked)="openTaskDetail($event)"
					></app-board-card>
				}
			</div>
		</div>

		<!-- IN PROGRESS COLUMN -->
		<div
			class="column-status"
			cdkDropList
			id="in-progress"
			[cdkDropListConnectedTo]="dropListIds"
			[cdkDropListData]="inProgressTasks()"
			(cdkDropListDropped)="drop($event)"
		>
			<div class="desktop-headline-btn">
				<h2 class="column-title">In Progress</h2>
				<div class="btn-overlay"></div>
			</div>
			<div class="column-body">
				@for (task of inProgressTasks(); track task.id) {
					<app-board-card
						cdkDrag
						[cdkDragData]="task"
						[task]="task"
						(cardClicked)="openTaskDetail($event)"
					></app-board-card>
				}
			</div>
		</div>

		<!-- AWAITING FEEDBACK COLUMN -->
		<div
			class="column-status"
			cdkDropList
			id="awaiting-feedback"
			[cdkDropListConnectedTo]="dropListIds"
			[cdkDropListData]="feedbackTasks()"
			(cdkDropListDropped)="drop($event)"
		>
			<div class="desktop-headline-btn">
				<h2 class="column-title">Awaiting Feedback</h2>
				<div class="btn-overlay"></div>
			</div>
			<div class="column-body">
				@for (task of feedbackTasks(); track task.id) {
					<app-board-card
						cdkDrag
						[cdkDragData]="task"
						[task]="task"
						(cardClicked)="openTaskDetail($event)"
					></app-board-card>
				}
			</div>
		</div>

    <!-- DONE COLUMN -->
    <div
      class="column-status"
      cdkDropList
      id="done"
      [cdkDropListConnectedTo]="dropListIds"
      [cdkDropListData]="doneTasks()"
      (cdkDropListDropped)="drop($event)"
    >

      <h2 class="column-title">Done</h2>

      <div class="column-body">
        @for (task of doneTasks(); track task.id) {
          <app-board-card
            cdkDrag
            [cdkDragData]="task"
            [task]="task"
            (cardClicked)="openTaskDetail($event)"
          ></app-board-card>
        }
      </div>
    </div>
  </main>

	<!-- Zeigt die TaskView nur an, wenn selectedTaskId einen Wert hat -->
	@if (selectedTaskId()) {
		<div class="overlay-wrapper">
			<div class="overlay-backdrop" (click)="closeTaskDetail()"></div>

			<app-task-view [taskId]="selectedTaskId()!" (closed)="closeTaskDetail()" />
		</div>
	}
</div>
